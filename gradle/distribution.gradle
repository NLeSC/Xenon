// Depends on plugins
//    id 'java'
//    id 'distribution'
//    id 'maven-publish'

//    PACKAGE
// ==============
task sourcesJar(type: Jar, dependsOn: classes) {
    description "Creates jar file of Java sources"
    classifier = 'sources'
    from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    description "Creates jar file of javadoc"
    classifier = 'javadoc'
    from javadoc.destinationDir
}

task examplesJar(type: Jar) {
    description "Creates jar file of Xenon examples"
    classifier = 'examples'
    from sourceSets.examples.output
}

artifacts {
    archives sourcesJar
    archives javadocJar
}

// TODO Distributions:
// 1. for maven, xenon.jar, xenon-src.jar, xenon-javadoc.jar
// 2. minimal, xenon.jar + deps*.jar
// 3. full, xenon.jar + deps*.jar + javadoc + examples + javadocdevel + unit tests +  integration tests

distributions {
    main {
        contents {
            def jar = project.tasks[JavaPlugin.JAR_TASK_NAME]
            into("lib") {
                from(jar)
                from(project.configurations.runtime)
            }
            into("docs") {
                from(userguideMarkdown.target)
                from('doc/user/userguide/userguide.pdf')
                into("javadoc") {
                    from(javadoc.destinationDir)
                }
                from(sourcesJar)
            }
            from {
                ['README.md',
                'LICENSE',
                'NOTICE',
                'notices'
                ]
            }
            into('examples') {
                from('src/examples')
                // TODO would like to have example source code in examples/src/main/java, but it is in examples/java, rename did not work
                from(examplesJar)
            }
        }
    }
}
distZip.dependsOn javadoc, userguidePdf
distTar.dependsOn javadoc, userguidePdf
installDist.dependsOn javadoc, userguidePdf

//     PUBLISH
// ==============
publishing {
    publications {
        MyPublication(MavenPublication) {
            from components.java
            groupId 'nl.esciencecenter.xenon'
            artifactId 'xenon'
            version version

            artifact sourcesJar
            artifact javadocJar
        }
    }
}
